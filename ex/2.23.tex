\exercise{2.23}
{
  Mostrare che i seguenti \textit{statement} del linguaggio \textbf{While} sono
  semanticamente equivalenti:
  \begin{enumerate}[label=\alph*)]
    \item ``$S$; skip'' and ``$S$''
    \item ``while $b$ do $S$'' and
      ``if $b$ then ($S$; while $b$ do $S$) else skip''
    \item ``$S_1$; ($S_2$; $S_3$)'' and ``($S_1$; $S_2$); $S_3$''
  \end{enumerate}
}
{
  Di seguito vengono esposte le varie equivalenze tra gli statement sopra
  elencati:

  \begin{enumerate}[label=\alph*)]
    \item \boxer{\confSs{S;\mbox{ skip}}{s} \Rar{*} s' \leftrightarrow 
         \confSs{S}{s} \Rar{*} s'}
% \boxer{``S; skip$''$ and ``S$''$} \\
    \begin{itemize}
      \item $(\rightarrow)$ Assumiamo vera
      $\confSs{S;\mbox{ skip}}{s} \Rar{*} s'$. \\
      Per il lemma di decomposizione, esiste uno stato intermedio $s''$ t.c.
      $\confSs{S}{s} \Rar{*} s''$ e $\confSs{\mbox{skip}}{s''} \Rar{*} s'$. \\
      Per la regola $[skip_{SOS}]$ si ha $s'' = s'$. \\
      Quindi vale $\confSs{S;\mbox{ skip}}{s} \Rar{*} s' \rightarrow \confSs{S}{s} 
      \Rar{*} s'$.

      \item $(\leftarrow)$ Assumiamo vera $\confSs{S}{s} \Rar{*} s'$. \\
      Per il lemma di composizione $\confSs{S; \mbox{skip}}{s} \Rar{*} 
      \confSs{\mbox{skip}}{s'}$. \\
      Per la regola $[skip_{SOS}]$ si ha $\confSs{\mbox{skip}}{s'} \Rar{} s'$,
      quindi vale $\confSs{S; \mbox{skip}}{s} \Rar{*} s'$. \\ 
      Ne consegue che 
      $ \confSs{S}{s} \Rar{*} s' \rightarrow 
         \confSs{S;\mbox{ skip}}{s} \Rar{*} s'$ risulta valida.     
    \end{itemize}
      Dall'unione dei due punti precedenti si ottiene 
      $\confSs{S;\mbox{ skip}}{s} \Rar{*} s' \leftrightarrow 
      \confSs{S}{s} \Rar{*} s'$
      \begin{flushright}
      $\Box$
      \end{flushright}

    \item \boxer{\confSs{while \ b \ do \ S}{s} \Rar{*} s' \leftrightarrow 
         \confSs{if  \ b \ then \ (S; \ while \ b \ do \ S) \ else \ skip}{s} 
         \Rar{*} s'} \\
% \boxer{``while \ b \ do \ S$''$ \ and
%      \ ``if  \ b \ then \ (S; \ while \ b \ do \ S) \ else \ skip$''$}. 
    \begin{itemize}
      \item $(\rightarrow)$ Assumiamo vera $\confSs{while \ b \ do \ S}{s} 
         \Rar{*} s'$. \\
         Per ipotesi $while \ b \ do \ S$ termina \textit{sempre} in un
         numero finito di passi, \\ quindi per il lemma di decomposizione esiste 
         uno stato intermedio $s''$ t.c. \\
         $\confSs{if  \ b \ then \ (S; \ while \ b \ do \ S) \ else \ skip}{s} 
         \Rar{*} \confSs{skip}{s''}$ perchè esiste $b = \semfalse$. \\
         Sempre per il lemma di decomposizione vale anche 
         $\confSs{skip}{s''} \Rar{*} s'$.\\
         L'unica regola applicabile è $[skip_{SOS}]$, da 
         $\confSs{skip}{s''} \Rar{} s'$ si ha $s''=s'$. \\
         Ne consegue che 
         $\confSs{while \ b \ do \ S}{s} \Rar{*} s' \rightarrow 
         \confSs{if  \ b \ then \ (S; \ while \ b \ do \ S) \ else \ skip}{s} 
         \Rar{*} s'$ risulta valida.
      \item $(\leftarrow)$ Assumiamo vera $\confSs{if  \ b \ then \ (S; 
            \ while \ b \ do \              S) \ else \ skip}{s} \Rar{*} s'$. \\
            Notiamo che per ipotesi $if  \ b \ then \ (S; \ while \ b \ do \ S) 
            \ else \ skip$ termina \textit{sempre}. \\
            Per il lemma di composizione $\confSs{while \ b \ do \ S}{s} \Rar{*} 
            \confSs{skip}{s'}$. \\
            L'unica regola applicabile è $[skip_{SOS}]$, quindi 
            $\confSs{skip}{s'} \Rar{} s'$. \\
            Quindi vale 
            $\confSs{if  \ b \ then \ (S; \ while \ b \ do \ S) \ else \ skip}{s} 
            \Rar{*} s' \rightarrow \confSs{while \ b \ do \ S}{s} \Rar{*} s'$.
      \end{itemize}
         Dall'unione dei due punti precedenti si ottiene \\ 
         $\confSs{while \ b \ do \ S}{s} \Rar{*} s' \leftrightarrow 
         \confSs{if  \ b \ then \ (S; \ while \ b \ do \ S) \ else \ skip}{s} 
         \Rar{*} s'$
         \begin{flushright}
         $\Box$
         \end{flushright}

    \item \boxer{\confSs{S_1; \ (S_2; \ S_3)}{s} \Rar{*} s' \leftrightarrow  
            \confSs{(S_1; \ S_2); \ S_3}{s} \Rar{*} s'} 
% \boxer{``S_1; \ (S_2; \ S_3)$''$ \ and \ ``(S_1; \ S_2); \ S_3$''$}.
    \begin{itemize}
      \item $(\rightarrow)$ Assumiamo vera $\confSs{S_1; \ (S_2; \ S_3)}{s} 
      \Rar{*} s'$. \\
      Per il lemma di decomposizione esiste uno stato intermedio $s''$ t.c. 
      $\confSs{S_1; \ S_2}{s} \Rar{*} s''$ e $\confSs{S_3}{s''} \Rar{*} s'$. \\
      Applicando l'assioma $\confSs{S}{s} \Rar{} s'$ si ha che lo statement 
      $S_3$ si riduce in un passo alla configurazione terminale $s'$: 
      $\confSs{S_3}{s''} \Rar{} s'$. Questo vale per ipotesi, infatti la 
      composizione degli statement $S_1;S_2;S_3$ si riduce \textit{sempre} in 
      un numero finito di passi ad una configurazione terminale. \\
      Dunque vale 
      $\confSs{S_1; \ (S_2; \ S_3)}{s} \Rar{*} s' \rightarrow  
      \confSs{(S_1; \ S_2); \ S_3}{s} \Rar{*} s'$.
      \item $(\leftarrow)$ Assumiamo vera $\confSs{(S_1; \ S_2); \ S_3}{s} 
      \Rar{*} s'$. \\
      Per il lemma di composizione $\confSs{S_1; \ (S_2; \ S_3)}{s} 
      \Rar{*} \confSs{S_2; \ S_3}{s'}$. \\
      Per ipotesi la composizione degli statement $S_1;S_2;S_3$ si riduce 
      \textit{sempre} in un numero finito di passi ad una configurazione 
      terminale. \\ In questo caso si ha una composizione di due regole 
      $[skip_{SOS}]$, che porta a $\confSs{skip; skip}{s'} 
      \Rar{2} s'$. \\
      Vale $\confSs{(S_1; \ S_2); \ S_3}{s} \Rar{*} s' \rightarrow 
      \confSs{S_1; \ (S_2; \ S_3)}{s} \Rar{*} s'$.  
    \end{itemize}
         Dall'unione dei due punti precedenti si ottiene \\ 
         $\confSs{S_1; \ (S_2; \ S_3)}{s} \Rar{*} s' \leftrightarrow  
         \confSs{(S_1; \ S_2); \ S_3}{s} \Rar{*} s'$
         \begin{flushright}
         $\Box$
         \end{flushright}

  \end{enumerate}
}
