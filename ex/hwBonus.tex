\exercise{Esercizio Bonus}
{Prove that
$$
	\wbS{b}{S} \eqDS \wbS{b}{(S; \ifABC{b}{S}{\skipForFriends})}
$$
}
{
Per dimostrare che 
$$
	\wbS{b}{S} \eqDS \wbS{b}{(S; \ifABC{b}{S}{\skipForFriends})}
$$	
devo dimostrare che
$$
\dsCtxt{\wbS{b}{S}} = \dsCtxt{\wbS{b}{(S; \ifABC{b}{S}{\skipForFriends})}}
$$
Il termine sulla sinistra è per quanto visto nei precedenti esercizi:
$$
\dsCtxt{\wbS{b}{S}} = \fixp{F} \text{ dove } F = \lambda g. \cond{b}{g \circ \dsCtxt{S}}{id}
$$
mentre quello sulla destra è:
$$
\dsCtxt{\wbS{b}{(S; \ifABC{b}{S}{\skipForFriends})}} = \fixp{G} \text{ dove } 
$$
dove 
$$
G = \lambda g. \cond{b}{g \circ \cond{b}{\dsCtxt{S}}{id} \circ \dsCtxt{S}}{id} 
$$

Noto che in questo caso non posso dimostrare che $\fixp{F} = \fixp{G}$ a partire da $F = G$ perchè
$F$ e $G$ non sono banalmente equivalenti.

\begin{proof}
Per dimostrare che $\fixp{F} = \fixp{G}$ sono equivalenti dimostro le due direzioni separatamente:
\begin{itemize}
  \item $\boxed{\fixp{F} \sqsubseteq \fixp{G}}$
  Cerco di sfruttare il \FPIL. Dimostrando che
  $$
  F(\fixp{G})\ s \sqsubseteq \fixp{G}\ s
  $$

  È possibile notare che:
  $$
  F(\fixp{G})\ s =
    \caseFun{(\fixp{G} \circ \dsCtxt{S})\ s}
            {\B{b} = \semtrue}
            {\idDS\ s = s}
            {\B{b} = \semfalse}
  $$
  Mentre il termine sulla destra evolve nel seguente modo:
  $$
  \fixp{G}\ s= G(\fixp{G})\ s =
    \caseFun{(\fixp{G} \circ \cond{b}{\dsCtxt{S}}{id} \circ \dsCtxt{S})\ s}
            {\B{b} = \semtrue}
            {\idDS\ s = s}
            {\B{b} = \semfalse}
  $$
  Il caso $\B{b} = \semfalse$ è banalmente verificato. Si dimostra quindi la
  tesi per il caso $\B{b} = \semtrue$, riducendo il termine sulla sinistra:
  $$
  (\fixp{G} \circ \dsCtxt{S})\ s =
    \caseFun{\fixp{G}\ s'}
            {\dsCtxt{S}\ s = s'}
            {\undefDS}
            {\dsCtxt{S}\ s = \undefDS}
  $$
  Mentre per il termine sulla destra vale:
  $$
  \fixp{G}\ s= G(\fixp{G})\ s =
    \caseFun{(\fixp{G} \circ \cond{b}{\dsCtxt{S}}{id})\ s'}
            {\dsCtxt{S}\ s = s'}
            {\undefDS}
            {\dsCtxt{S}\ s = \undefDS}
  $$
  Il caso $\dsCtxt{S}\ s = \undefDS$ è banalmente verificato, perciò occorre
  solamente verificare il caso $\dsCtxt{S} = s'$:
  $$
  \fixp{G}\ s' = G(\fixp{G})\ s' = 
    \caseFun{(\fixp{G} \circ \cond{b}{\dsCtxt{S}}{id} \circ \dsCtxt{S})\ s'}
            {\B{b}' = \semtrue}
            {s'}
            {\B{b}' = \semfalse}
  $$
  Mentre per il termine sulla destra:
  $$
  (\fixp{G} \circ \cond{b}{\dsCtxt{S}}{id})\ s' =
    \caseFun{(\fixp{G} \circ \dsCtxt{S}) s'}
            {\B{b}' = \semtrue}
            {(\fixp{G} \circ \idDS)\ s' = (\fixp{G})\ s'}
            {\B{b}' = \semfalse}
  $$
  Ma nel caso $\B{b}' = \semfalse$, $(\fixp{G}) s'$ è proprio $s'$ poichè:
  $$
  \begin{array}{lr}
  (\fixp{G}) s' = & \text{(applicazione punto fisso)} \\
  G (\fixp{G}) s' = & \B{b}' = \semfalse \\
  \idDS\ s' = & \text{(definizione \idDS)} \\
  s' & \\
  \end{array}
  $$
  Resta dunque da provare che, nel caso $\B{b}' = \semtrue$, si ha:
  $$
  (\fixp{G} \circ \cond{b}{\dsCtxt{S}}{id} \circ \dsCtxt{S})\ s' =
  (\fixp{G} \circ \dsCtxt{S}) s'
  $$

  %%% SECONDA PARTE
  \item $\boxed{\fixp{F} \sqsupseteq \fixp{G}}$
  Cerco di sfruttare il \FPIL, dimostrando che
  $$
  G(\fixp{F})\ s \sqsubseteq \fixp{F}\ s
  $$

  È possibile notare che:
  $$
  G(\fixp{F})\ s =
    \caseFun{(\fixp{F} \circ
                 \cond{b}{\dsCtxt{S}}{id} \circ \dsCtxt{S})\ s}
            {\B{b} = \semtrue}
            {\idDS\ s = s}
            {\B{b} = \semfalse}
  $$
  E che:
  $$
  \fixp{F}\ s = F(\fixp{F})\ s =
    \caseFun{(\fixp{F} \circ \dsCtxt{S})\ s}
            {\B{b} = \semtrue}
            {\idDS\ s = s}
            {\B{b} = \semfalse}
  $$
  Siccome se $\B{b} = \semfalse$ si ottengono due stati banalmente equivalenti,
  la dimostrazione procede dimostrando $\B{b} = \semtrue$.

  Il termine sulla sinistra evolve nel seguente modo:
  $$
  (\fixp{F} \circ \cond{b}{\dsCtxt{S}}{id} \circ \dsCtxt{S})\ s =
    \caseFun{(\fixp{F} \circ
                 \cond{b}{\dsCtxt{S}}{id})\ s'}
            {\dsCtxt{S}\ s = s'}
            {\undefDS}
            {\dsCtxt{S}\ s = \undefDS}
  $$
  Mentre quello sulla destra:
  $$
  (\fixp{F} \circ \dsCtxt{S})\ s =
    \caseFun{\fixp{F}\ s'}
            {\dsCtxt{S}\ s = s'}
            {\undefDS}
            {\dsCtxt{S}\ s = \undefDS}
  $$

  Quindi, posso considerare solo il caso $\dsCtxt{S}\ s = s'$ (in quanto il
  caso $\dsCtxt{S}\ s = \undefDS$ è banalmente verificato). A questo, il
  termine sulla sinistra evolve nel seguente modo:
  $$
  (\fixp{F} \circ \cond{b}{\dsCtxt{S}}{id})\ s' =
    \caseFun{(\fixp{F} \circ \dsCtxt{S})\ s'}
            {\B{b}' = \semtrue}
            {s'}
            {\B{b}' = \semfalse}
  $$
  Mentre per il termine sulla destra:
  $$
  \fixp{F}\ s' = F(\fixp{F})\ s' =
    \caseFun{(\fixp{F} \circ \dsCtxt{S})\ s'}
            {\B{b} = \semtrue}
            {\idDS\ s' = s'}
            {\B{b} = \semfalse}
  $$
  A questo punto i termini sono equivalenti.
\end{itemize}

\end{proof}

\paragraph{Derivazione di G}
$$
\begin{array}{ll}
\dsCtxt{\wbS{b}{(S; \ifABC{b}{S}{\skipForFriends})}} & \\
\dsCtxt{\ifABC{b}{((S;  \ifABC{b}{S}{\skipForFriends}); \wbS{b}{(S; \ifABC{b}{S}{\skipForFriends})} )}{\skipForFriends}} & \\
\cond{b}{\dsCtxt{((S;  \ifABC{b}{S}{\skipForFriends}); \wbS{b}{(S; \ifABC{b}{S}{\skipForFriends})}}}{\dsCtxt{\skipForFriends}} \\
\cond{b}{\dsCtxt{\wbS{b}{(S; \ifABC{b}{S}{\skipForFriends})}} \circ \dsCtxt{(S;  \ifABC{b}{S}{\skipForFriends})}}{id} & \\
\cond{b}{\dsCtxt{\wbS{b}{(S; \ifABC{b}{S}{\skipForFriends})}} \circ \dsCtxt{\ifABC{b}{S}{\skipForFriends}} \circ \dsCtxt{S} }{id} & \\
\cond{b}{\dsCtxt{\wbS{b}{(S; \ifABC{b}{S}{\skipForFriends})}} \circ \cond{b}{\dsCtxt{S}}{\dsCtxt{\skipForFriends}} \circ \dsCtxt{S} }{id} & \\
\cond{b}{\dsCtxt{\wbS{b}{(S; \ifABC{b}{S}{\skipForFriends})}} \circ \cond{b}{\dsCtxt{S}}{id} \circ \dsCtxt{S} }{id} & \\
\end{array}
$$
per avere una definizione composizionale sostituisco $\dsCtxt{\wbS{b}{(S; \ifABC{b}{S}{\skipForFriends})}} $ con $g$ e ottengo:
$$
\cond{b}{g \circ \cond{b}{\dsCtxt{S}}{\dsCtxt{\skipForFriends}} \circ \dsCtxt{S} }{id}
$$
}